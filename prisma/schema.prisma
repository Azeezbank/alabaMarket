generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model user {
  id             String    @id @default(uuid())   @db.Uuid
  email          String?   @unique
  phone          String?   @unique
  password       String?
  otp            String
  expiresAt      DateTime    
  sign_up_verify     Boolean   @default(false)
  googleId       String    @unique
  createdAt      DateTime  @default(now())
  product       Product[]
  savedItems   Product[]  @relation("SavedProducts")
  profile    Profile?
  reviews     ProductReview[]
}

model Profile {
  id     String    @id @default(uuid)   @db.Uuid
  name  String
  profile_pic     String
  userId      String
  user    user  @relation(fields: [userId], references: [id])
  role      String
}

model ProductCat {
  id   String    @id     @default(uuid())     @db.Uuid
  name   String
  image   String?
  createdAt     DateTime     @default(now())
  products Product[]
}

model Product {
  id       String   @id   @default(uuid())  @db.Uuid
  name     String
  condition  String?
  price      Decimal?   @db.Decimal(10, 2)    @default(0.00)
  power      String?
  warranty   String?
  productCatId  String
  category      ProductCat   @relation(fields: [productCatId], references: [id])
  description   String?
  location      String?
  promoted      Boolean     @default(false)
  negotiable    Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt   DateTime  @updatedAt
  reviews     ProductReview[]
  images       ProductImage[]
  userId        String
  seller       user     @relation(fields: [userId], references: [id])
  savedByUsers user[]     @relation("SavedProducts")
}

model Comment {
  id     String   @id   @default(uuid())  @db.Uuid
  content   String
  createdAt DateTime @default(now())

  // Relations
  userId    String
  user      user     @relation(fields: [userId], references: [id])
  productId String
  product   Product  @relation(fields: [productId], references: [id])
}

model Like {
  id     String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())

  // Relations
  userId    String
  user      user     @relation(fields: [userId], references: [id])
  productId String
  product   Product  @relation(fields: [productId], references: [id])

  @@unique([userId, productId]) // user can like a product only once
}

model ProductReview {
  id        String   @id @default(uuid()) @db.Uuid
  rating    Int      // 1 to 5 stars
  comment   String?
  productId String
  product   Product  @relation(fields: [productId], references: [id])
  userId    String
  user      user     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

model ProductImage {
  id         String   @id @default(uuid()) @db.Uuid
  url        String?   // image URL or path
  productId  String
  product    Product  @relation(fields: [productId], references: [id])
  createdAt  DateTime @default(now())
}

model Notification {
  id    String    @id     @default(uuid())    @db.Uuid
  user      user     @relation(fields: [userId], references: [id])
  userId    String   @db.Uuid
  message   String
  type      String   // e.g., 'order', 'promo', 'system'
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}