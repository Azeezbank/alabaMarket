generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String              @id @default(uuid()) @db.Uuid
  email                 String?             @unique
  phone                 String?             @unique
  password              String?
  otp                   String?
  expiresAt             DateTime?
  sign_up_verify        Boolean             @default(false)
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @default(now()) @updatedAt
  product               Product[]
  profile               Profile?
  productReview         ProductReview[]
  sellerShop            SellerShop[]
  sellerVerification    SellerVerification?
  comment               Comment[]
  notification          Notification[]
  likes                 Likes[]
  sellerRating          SellerRating[]      @relation("SellerRatings")
  customerRatings       SellerRating[]      @relation("CustomerRatings")
  storeActivities       StoreActivities[]
  savedProducts         SavedProducts[]
  question              Question[]
  love                  Love[]
  sentMessages          Chat[]              @relation("SentMessages")
  receivedMessages      Chat[]              @relation("ReceivedMessages")
  activities            Activities[]
  ticket                Ticket[]
  subscriptionPlanId    String?             @unique @db.Uuid
  subscriptionPlan      SubscriptionPlan?   @relation(fields: [subscriptionPlanId], references: [id])
  subscriptionExpiresAt DateTime?
  transaction           Transaction[]
}

model SubscriptionPlan {
  id                 String            @id @default(uuid()) @db.Uuid
  name               String
  price              Decimal           @default(0.00) @db.Decimal(10, 2)
  duration           String?
  maxVisibleProducts Int               @default(2)
  placement          String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @default(now()) @updatedAt
  users              User?
  maxVisiblePerCat   MaxVisiblePerCat?
  transaction        Transaction[]
}

model MaxVisiblePerCat {
  id                 String           @id @default(uuid()) @db.Uuid
  subscriptionPlanId String           @unique @db.Uuid
  maxVisible         Int
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @default(now()) @updatedAt
  subscriptionPlan   SubscriptionPlan @relation(fields: [subscriptionPlanId], references: [id], onDelete: Cascade)
}

model Profile {
  id          String      @id @default(uuid()) @db.Uuid
  name        String?
  profile_pic String?
  userId      String      @unique @db.Uuid
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  role        ProfileRole @default(Buyer)
  rank        String?
  status      String?
  googleId    String?
  isVerified  Boolean     @default(false)
  lastVisit   DateTime?   @default(now())
}

enum ProfileStatus {
  Active
  Inactive
}

enum ProfileRole {
  Buyer
  Seller
  Admin
}

model Product {
  id              String          @id @default(uuid()) @db.Uuid
  name            String?
  userId          String          @db.Uuid
  isActive        Boolean         @default(true)
  isPause         Boolean         @default(false)
  shopId          String          @db.Uuid
  status          ProductStatus   @default(Pending)
  categoryName    String?
  subCategoryName String?
  categoryId      String?         @db.Uuid
  subCategoryId   String?         @db.Uuid
  productPhoto    ProductPhoto[]
  productVideo    ProductVideo[]
  productPricing  ProductPricing?
  comment         Comment[]
  isVisible       Boolean         @default(false)
  visibleMarkedAt DateTime?
  shop            SellerShop      @relation(fields: [shopId], references: [id], onDelete: Cascade)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @default(now()) @updatedAt
  likes           Likes[]
  category        Category?       @relation(fields: [categoryId], references: [id])
  subCategory     SubCategory?    @relation(fields: [subCategoryId], references: [id])
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  productReview   ProductReview[]
  savedProducts   SavedProducts[]
  love            Love[]
  actionLog       ActionLog?

  //Pending
  power    String?
  warranty String?
  location String?
}

enum ProductStatus {
  Approved
  Pending
  Rejected
}

enum ProductpricingStatus {
  Approved
  Pending
  Rejected
}

model SavedProducts {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @db.Uuid
  productId String   @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
}

model Category {
  id          String        @id @default(uuid()) @db.Uuid
  image       String?
  name        String?
  status      Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(now()) @updatedAt
  product     Product[]
  subCategory SubCategory[]
}

model SubCategory {
  id         String    @id @default(uuid()) @db.Uuid
  name       String
  categoryId String    @db.Uuid
  status     Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @default(now()) @updatedAt
  category   Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  product    Product[]
}

model ProductPhoto {
  id        String   @id @default(uuid()) @db.Uuid
  url       String?
  productId String   @db.Uuid
  product   Product? @relation(fields: [productId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model ProductVideo {
  id        String   @id @default(uuid()) @db.Uuid
  productId String?  @db.Uuid
  url       String?
  product   Product? @relation(fields: [productId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model ProductPricing {
  id          String   @id @default(uuid()) @db.Uuid
  productId   String   @unique @db.Uuid
  price       Decimal  @default(0.00) @db.Decimal(10, 2)
  priceStatus String?
  condition   String
  description String?
  createdAt   DateTime @default(now())
  product     Product  @relation(fields: [productId], references: [id])
  updatedAt   DateTime @default(now()) @updatedAt
}

model SellerRating {
  id         String   @id @default(uuid()) @db.Uuid
  rating     Int
  comment    String
  customerId String   @db.Uuid
  userId     String   @db.Uuid
  createdAt  DateTime @default(now())
  user       User     @relation("SellerRatings", fields: [userId], references: [id])
  customer   User     @relation("CustomerRatings", fields: [customerId], references: [id])
  updatedAt  DateTime @default(now()) @updatedAt
}

model ProductReview {
  id        String   @id @default(uuid()) @db.Uuid
  stars     Int?     @db.SmallInt
  comment   String?
  productId String   @unique @db.Uuid
  product   Product  @relation(fields: [productId], references: [id])
  userId    String   @db.Uuid
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@unique([userId, productId])
}

model Comment {
  id        String   @id @default(uuid()) @db.Uuid
  content   String
  productId String   @db.Uuid
  userId    String   @db.Uuid
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
  updatedAt DateTime @default(now()) @updatedAt
}

model Likes {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())
  userId    String?   @unique @db.Uuid
  user      User?     @relation(fields: [userId], references: [id])
  productId String   @unique @db.Uuid
  product   Product  @relation(fields: [productId], references: [id])
  updatedAt DateTime @default(now()) @updatedAt

  @@unique([userId, productId])
}

model Love {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())
  userId    String?   @unique @db.Uuid
  user      User?     @relation(fields: [userId], references: [id])
  productId String   @unique @db.Uuid
  product   Product  @relation(fields: [productId], references: [id])
  updatedAt DateTime @default(now()) @updatedAt

  @@unique([userId, productId])
}

model Notification {
  id         String   @id @default(uuid()) @db.Uuid
  senderId   String   @db.Uuid
  message    String?
  receiverId String?  @db.Uuid
  type       String
  isRead     Boolean  @default(false)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [senderId], references: [id])
  updatedAt  DateTime @default(now()) @updatedAt
}

model SellerShop {
  id           String    @id @default(uuid()) @db.Uuid
  storeName    String?
  logo         String?
  description  String?
  storeAddress String?
  most_sell    String?
  storeEmail   String?
  phoneNumber  String?
  userId       String    @unique @db.Uuid
  isActive     Boolean   @default(true)
  product      Product[]
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt
}

model SellerVerification {
  id         String                   @id @default(uuid()) @db.Uuid
  userId     String                   @unique @db.Uuid
  ID_card    String?
  selfie     String?
  terms      Boolean                  @default(false)
  isVerified Boolean                  @default(false)
  status     SellerVerificationStatus @default(Pending)
  user       User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt  DateTime                 @default(now())
  updatedAt  DateTime                 @default(now()) @updatedAt
  actionLog  ActionLog?
}

enum SellerVerificationStatus {
  Approved
  Pending
  Rejected
}

model StoreActivities {
  id           String   @id @default(uuid()) @db.Uuid
  activityType String?
  description  String
  userId       String   @unique @db.Uuid
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id])
  updatedAt    DateTime @default(now()) @updatedAt
}

model Activities {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @db.Uuid
  activity  String
  created   DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model Report {
  id          String   @id @default(uuid()) @db.Uuid
  productId   String?  @db.Uuid
  sellerId    String?  @db.Uuid
  userId      String   @db.Uuid
  reason      String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt
}

model Question {
  id         String         @id @default(uuid()) @db.Uuid
  userId     String         @db.Uuid
  receiverId String?        @db.Uuid
  question   String
  status     QuestionStatus @default(Pending)
  user       User           @relation(fields: [userId], references: [id])
  updatedAt  DateTime       @default(now()) @updatedAt
}

enum QuestionStatus {
  Pending
  Answered
}

model Chat {
  id         String   @id @default(uuid()) @db.Uuid
  senderId   String   @db.Uuid
  receiverId String   @db.Uuid
  content    String?
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  updatedAt  DateTime @default(now()) @updatedAt
}

model Ticket {
  id          String     @id @default(uuid()) @db.Uuid
  ticketId    String     @unique
  submittedBy String
  issueSumary String
  category    String?
  status      String?
  createdAt   DateTime   @default(now())
  assignedTo  String?
  updatedAt   DateTime   @default(now()) @updatedAt
  userId      String     @db.Uuid
  user        User       @relation(fields: [userId], references: [id])
  actionLog   ActionLog?
}

model RoleMgt {
  id             String   @id @default(uuid()) @db.Uuid
  roleName       String
  description    String
  number_of_user Int?
  permissions    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now()) @updatedAt
}

model ActionLog {
  id                   String              @id @default(uuid()) @db.Uuid
  type                 String?
  action               String?
  reason               String
  performedBy          String              @db.Uuid
  createdAt            DateTime            @default(now())
  productId            String?             @unique @db.Uuid
  boostAdId            String?             @unique @db.Uuid
  sellerVerificationId String?             @unique @db.Uuid
  ticketId             String?             @unique @db.Uuid
  updatedAt            DateTime            @default(now()) @updatedAt
  product              Product?            @relation(fields: [productId], references: [id], onDelete: Cascade)
  sellerVerification   SellerVerification? @relation(fields: [sellerVerificationId], references: [id], onDelete: Cascade)
  ticket               Ticket?             @relation(fields: [ticketId], references: [id], onDelete: Cascade)
}

model Transaction {
  id                 String           @id @default(uuid())
  reference          String           @unique
  amount             Float
  status             String // PENDING | SUCCESS | FAILED
  userId             String           @db.Uuid
  user               User             @relation(fields: [userId], references: [id])
  subscriptionPlanId String           @db.Uuid
  subscriptionPlan   SubscriptionPlan @relation(fields: [subscriptionPlanId], references: [id])
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @default(now()) @updatedAt
}

model PaymentProvider {
  id                   Int                 @id @default(autoincrement())
  name                 PaymentProviderName
  publicKey            String?
  secretKey            String
  flutterWebhookSecret String              @default("d8f3a7c2b9e541f0a4c7e63d9f28ac12")
  isActive             Boolean             @default(false)
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @default(now()) @updatedAt
}

enum PaymentProviderName {
  paystack
  flutterwave
}
